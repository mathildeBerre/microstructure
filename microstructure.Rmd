---
title: "Projet de microstructure"
author: "Mathilde Berregard, Théophile Charmont, Mohammed Fellaji, Alexandra Herbadji, Ayoub Jarraya"
date: "13/03/2018"
output: html_document
---

## 

``` {r echo=FALSE}
#installer et télécharger le package xlsx
install.packages("xlsx")
install.packages("rJava")
install.packages("xlsxjars")
install.packages("readxl")
```
## importation des données

``` {r echo=FALSE}
# Ouverture du fichier Excel et importation des données présentes sur la feuille 1
library(xlsx)
library(readxl)
data_final_facteurs_fusionne_2 <- read_excel("../data_final_facteurs_fusionne_2.xlsx", 1)
```

## Statistiques descriptives
``` {r echo=FALSE}

vecteurRenta <- data_final_facteurs_fusionne_2["return_rf"]
summary(vecteurRenta)

vecteurBeta <- data_final_facteurs_fusionne_2["beta"]
summary(vecteurBeta)

vecteurAIM <- data_final_facteurs_fusionne_2["AIM"]
summary(vecteurAIM)

vecteurlogMarket <- data_final_facteurs_fusionne_2["log_market_cap"]
summary(vecteurlogMarket)

vecteurLogBTM <- data_final_facteurs_fusionne_2["log_btm"]
summary(vecteurLogBTM)
  
vecteurPIN <- data_final_facteurs_fusionne_2["pin"]
summary(vecteurPIN)
  
vecteurFsrv <- data_final_facteurs_fusionne_2["fsrv"]
summary(vecteurFsrv)
  
vecteurTurnover <- data_final_facteurs_fusionne_2["turnover"]
summary(vecteurTurnover)
  
vecteurIlliqAmu <- data_final_facteurs_fusionne_2["illiq_amihud"]
summary(vecteurIlliqAmu)
  
vecteurBetaSMB <- data_final_facteurs_fusionne_2["betaSMB"]
summary(vecteurBetaSMB)
  
vecteurBetaHML <- data_final_facteurs_fusionne_2["betaHML"]
summary(vecteurBetaHML)
  
vecteurBetaMOM <- data_final_facteurs_fusionne_2["betaMOM"]
summary(vecteurBetaMOM)
  
vecteurMarketReturn <- data_final_facteurs_fusionne_2["Marketretrun"]
summary(vecteurMarketReturn)
  
vecteurSMB <- data_final_facteurs_fusionne_2["SmallMinusBig"]
summary(vecteurSMB)
  
vecteurHML <- data_final_facteurs_fusionne_2["HighMinusLow"]
summary(vecteurBetaHML)
  
vecteurMOM <- data_final_facteurs_fusionne_2["MomentumFactor"]
summary(vecteurMOM)


```
## Etude de la corrélation de AIM

``` {r echo=FALSE}
'vecteurAIM <- data_final_facteurs_fusionne_2["AIM"]
vecteurBeta <- data_final_facteurs_fusionne_2[""]
cor()'

```

## Regression linéaire
``` {r echo=FALSE}

x = c()
y = c()
year = 1965
month = 1
date = 0

vectorRentaB <- c()

vectorRentaPin= c()


vectorRentaAIM = c()


vectorRentaAIMBb = c()
vectorRentaAIMBa = c()



while (year < 2005) {
  dataTest =  data_final_facteurs_fusionne_2[data_final_facteurs_fusionne_2$month == month & data_final_facteurs_fusionne_2$year == year,]
  
  if (length(dataTest$return_rf[!is.na(dataTest$return_rf) & !is.na(dataTest$beta_t1)])!=0) 
  {
  estimationRentaBeta <- lm(dataTest$return_rf[!is.na(dataTest$return_rf) & !is.na(dataTest$beta_t1)]~dataTest$beta_t1[!is.na(dataTest$return_rf) & !is.na(dataTest$beta_t1)])
  
  vectorRentaB <- rbind(vectorRenta, coef(estimationRentaBeta)[2])
  
  #moyenneRentaBeta = moyenneRentaBeta + coef(estimationRentaBeta)[2]
  
  ##rint(summary(estimationRentaBeta)[[4]][2,4])
  
  #moyenneRentaBetaPvalue = moyenneRentaBetaPvalue + summary(estimationRentaBeta)[[4]][2,4]
 
  
  }
  
  if (length(dataTest$return_rf[!is.na(dataTest$return_rf) & !is.na(dataTest$pin_t1)])!=0) 
  {
     estimationRentaPin <- lm(dataTest$return_rf[!is.na(dataTest$return_rf) & !is.na(dataTest$pin_t1)]~dataTest$pin_t1[!is.na(dataTest$return_rf) & !is.na(dataTest$pin_t1)])
  
  vectorRentaPin <- rbind(vectorRentaPin, coef(estimationRentaPin)[2])



  }
  
  if (length(dataTest$return_rf[!is.na(dataTest$return_rf) & !is.na(dataTest$AIM_t1)])!=0) 
  {
     estimationRentaAIM <- lm(dataTest$return_rf[!is.na(dataTest$return_rf) & !is.na(dataTest$AIM_t1)]~dataTest$AIM_t1[!is.na(dataTest$return_rf) & !is.na(dataTest$AIM_t1)])
  
  vectorRentaAIM  <- rbind(vectorRentaAIM, coef(estimationRentaAIM)[2])

  }
  
   if (length(dataTest$return_rf[!is.na(dataTest$return_rf) & (!is.na(dataTest$AIM_t1) & !is.na(dataTest$beta_t1))] ) !=0) 
  {
     estimationRentaAIMB <- lm(dataTest$return_rf[!is.na(dataTest$return_rf) & !is.na(dataTest$AIM_t1) & !is.na(dataTest$beta_t1)]~dataTest$AIM_t1[!is.na(dataTest$return_rf) & !is.na(dataTest$AIM_t1) & !is.na(dataTest$beta_t1)] + dataTest$beta_t1[!is.na(dataTest$return_rf) & !is.na(dataTest$AIM_t1) & !is.na(dataTest$beta_t1)] )

  vectorRentaAIMBb  <- rbind(vectorRentaAIMBb, coef(estimationRentaAIMBb)[2])
  vectorRentaAIMBa  <- rbind(vectorRentaAIMBa, coef(estimationRentaAIMBa )[3])
  
  
  }
  


  
  month = month + 1
  date = date + 1
  if (month == 13) {
    month = 1
    year = year + 1
  }
}


print(mean(vectorRentaB))
t.test(vectorRentaB, conf.level = 0.95)

print(mean(vectorRentaAIM))

t.test(vectorRentaAIM, conf.level = 0.95)

t.test(vectorRentaPin,  conf.level = 0.95)

t.test(vectorRentaAIMB,  conf.level = 0.95)






```

``` {r echo=FALSE}
moyenneRentaBeta = moyenneRentaBeta/date
summary(moyenneRentaBeta)

vecteurRenta <- data_final_facteurs_fusionne_2["return_rf"]

vecteurBeta <- data_final_facteurs_fusionne_2["beta"]

estimationRentaBeta <- lm(data_final_facteurs_fusionne_2$return_rf~data_final_facteurs_fusionne_2$beta)

estimationRentaAIM <- lm(data_final_facteurs_fusionne_2$return_rf~data_final_facteurs_fusionne_2$AIM_t1)

estimationRentaBetaAim <- lm(data_final_facteurs_fusionne_2$return_rf~data_final_facteurs_fusionne_2$beta_t1 + data_final_facteurs_fusionne_2$AIM_t1)

estimationRentaPin <- lm(data_final_facteurs_fusionne_2$return_rf~data_final_facteurs_fusionne_2$pin_t1)

estimationGlobale <- lm(data_final_facteurs_fusionne_2$return_rf~data_final_facteurs_fusionne_2$beta_t1 + data_final_facteurs_fusionne_2$AIM_t1 + data_final_facteurs_fusionne_2$log_market_cap_t1 + data_final_facteurs_fusionne_2$log_btm_t1 + data_final_facteurs_fusionne_2$pin_t1 + data_final_facteurs_fusionne_2$fsrv_t1 + data_final_facteurs_fusionne_2$turnover_t1 + data_final_facteurs_fusionne_2$illiq_amihud_t1 + data_final_facteurs_fusionne_2$betaSMB_t1 + data_final_facteurs_fusionne_2$betaHML_t1 + data_final_facteurs_fusionne_2$betaMOM_t1)



summary(estimationGlobale)

print(coef(estimationGlobale)[3])

summary(estimationGlobale)[[4]][2,4]

```


